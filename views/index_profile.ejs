<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ahey Library-Profile</title>
    <link rel="stylesheet" href="/stylesheets/bootstrap/bootstrap.min.css" type="text/css">
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/stylesheets/profile.css" type="text/css">
    <!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
        crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.1.1/css/all.css"
        integrity="sha384-/frq1SRXYH/bSyou/HUp/hib7RVN1TawQYja658FEOodR/FQBKVqT9Ol+Oz3Olq5" crossorigin="anonymous" /> -->
    <!-- <link rel="stylesheet" href="fontawesome-free-6.1.1-web/css/all.css"> -->
    <link rel="stylesheet" href="/fontawesome-free-6.1.1-web/css/all.css" type="text/css">
</head>
<body>
    <nav class="navbar navbar-expand-sm navbar-dark bg-dark">
        <div class="container">
            <div class="p-5">
                <a href="/" class="navbar-brand fs-3 fw-normal">AHEY LIBRARY</a>
            </div>
            <div class="p-5 justify-content-center">
                <form action="/search" method="get">
                    <input type="text" class="form-control" placeholder="Search" style="width: 480px;" name="bookname" />
                    <input type="submit" hidden />
                </form>
            </div>
            <div class="p-5 justify-content-end">
                <% if( user == undefined) { %>
                    <a href="/login" class="btn btn-dark"><svg xmlns="http://www.w3.org/2000/svg" width="36" height="36"
                            fill="currentColor" class="bi bi-person" viewBox="0 0 16 16">
                            <path
                                d="M8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm2-3a2 2 0 1 1-4 0 2 2 0 0 1 4 0zm4 8c0 1-1 1-1 1H3s-1 0-1-1 1-4 6-4 6 3 6 4zm-1-.004c-.001-.246-.154-.986-.832-1.664C11.516 10.68 10.289 10 8 10c-2.29 0-3.516.68-4.168 1.332-.678.678-.83 1.418-.832 1.664h10z" />
                    </svg></a>
                <% } %>
                <% if( user != undefined) { %>
                    <a href="/profile/<%= user._id %>" class="btn btn-dark"><%= user.user_name %></a>
                    <a href="/logout" class="btn btn-dark"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-right" viewBox="0 0 16 16">
                        <path fill-rule="evenodd" d="M10 12.5a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1-.5-.5v-9a.5.5 0 0 1 .5-.5h8a.5.5 0 0 1 .5.5v2a.5.5 0 0 0 1 0v-2A1.5 1.5 0 0 0 9.5 2h-8A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h8a1.5 1.5 0 0 0 1.5-1.5v-2a.5.5 0 0 0-1 0v2z"></path>
                        <path fill-rule="evenodd" d="M15.854 8.354a.5.5 0 0 0 0-.708l-3-3a.5.5 0 0 0-.708.708L14.293 7.5H5.5a.5.5 0 0 0 0 1h8.793l-2.147 2.146a.5.5 0 0 0 .708.708l3-3z"></path>
                      </svg></a>
                <% } %>
            </div>
        </div>
    </nav>
    <nav class="navbar navbar-expand-sm navbar-dark bg-secondary sticky-top">
        <div class="container">
            <button class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar1">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div id="navbar1" class="collapse navbar-collapse">
                <ul class="navbar-nav mx-auto">
                    <li class="nav-item me-5">
                        <a href="/" class="nav-link">หน้าแรก</a>
                    </li>
                    <li class="nav-item me-5">
                        <a href="/category/novel" class="nav-link">นิยาย</a>
                    </li>
                    <li class="nav-item me-5">
                        <a href="/category/general" class="nav-link">หนังสือทั่วไป</a>
                    </li>
                    <li class="nav-item me-5">
                        <a href="/category/children" class="nav-link">หนังสือเด็ก</a>
                    </li>
                    <li class="nav-item me-5">
                        <a href="/category/manga" class="nav-link">การ์ตูน</a>
                    </li>
                    <li class="nav-item me-5">
                        <a href="/board" class="nav-link">กระดาน</a>
                    </li>
                    <li class="nav-item me-5">
                        <a href="/thread" class="nav-link">กระทู้</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <br>
    <div id="con_profile" class="container bootstrap snippets bootdey">
        <div class="row">
          <div class="profile-nav col-md-3">
              <div class="panel">
                  <div class="user-heading round">
                      <a>
                          <img src="/images/__ia_thumb.jpg" alt="">
                      </a>
                      <h1 id="user_profile"><%= user.user_name %></h1>
                      <p id="email_profile"><%= user.user_email %></p>
                  </div>
              </div>
          </div>
          <div class="profile-info col-md-9">
              <div class="panel">
                  <div class="panel-body bio-graph-info">
                      <h1>About</h1>
                      <div class="row" style="background-color: #fbc02d;padding: 25px;border-radius: 5px; height: 15rem;">
                          <div class="bio-row">
                            <form id="edit_info" action="/profile/<%= user._id %>/edit" method="post">
                                <input type="hidden" name="user_id" value="<%= user._id %>">
                                <p style="color: white; font-size: 15px;display: inline; word-spacing:0.5rem;" ><i class="fa-solid fa-user"></i> Username<p style="color: white; font-size: 15px;display: inline; word-spacing:4.2rem;"> :</p><p style="color: white; font-size: 15px; display: inline;" id="fname"> <%= user.user_name %></p></p>
                                <p style="color: white; font-size: 15px;display: inline; word-spacing:0.5rem;" ><i class="fa-solid fa-key"></i> Password<p style="color: white; font-size: 15px;display: inline; word-spacing:4.4rem;"> :</p><p style="color: white; font-size: 15px; display: inline;" id="pword"> ********</p></p>
                                <p style="color: white; font-size: 15px;display: inline; word-spacing:0.5rem;" ><i class="fa-solid fa-check"></i> Confirm password :<p style="color: white; font-size: 15px; display: inline;" id="cpword"> ********</p></p>
                                <p style="color: white; font-size: 15px;display: inline; word-spacing:0.5rem;" ><i class="fa-solid fa-envelope"></i> E-mail<p style="color: white; font-size: 15px;display: inline; word-spacing:5.8rem;"> :</p><p style="color: white; font-size: 15px; display: inline;" id="e_mail"> <%= user.user_email %></p></p>
                                <!-- <input id="edituserid" name="name" type="text" size="20"> -->
                            <button type="button" id="btnedit_profile" class="btn" value="editing"  >Edit</button>
                            
                            <button type="button" id="btncancle_profile" class="btn" value="cancle" style="display: none;">Cancle</button>
                            
                            
                            <div class="modal_contain" id="modal_contain">
                                <div class="modal_body">
                                        <p class="popcon_header">กรุณาป้อนรหัสผ่านเก่าเพื่อยืนยัน</p>
                                    <!-- <form id="form_popcon"> -->
                                        <input type="password" class="form-control" id="popcon_password" name="confirmpassword" placeholder="Password">
                                        <div id="error_messsage"></div>
                                        <button type="submit" class="btn" id="popcon">Confirm</button>
                                        <button type="button" class="btn" id="btncancle_profile2">Cancle</button>
                                    <!-- </form> -->
                                </div>
                            </div>
                            </form>
                            <script>
                                var passname = document.getElementById('fname')
                                var pass_password = document.getElementById('pword')
                                var pass_confirmpassword = document.getElementById('cpword')
                                var passemail = document.getElementById('e_mail')
                                // var cancle = document.getElementById("cancle");
                                // var hidden = cancle.getAttribute("hidden");
                                document.getElementById('btnedit_profile').addEventListener('click', function() {
                                    document.getElementById("btncancle_profile").style.display = "inline";
                                    // if (hidden) {
                                    //     cancle.removeAttribute("hidden");
                                    // }
                                    if(document.getElementById('btnedit_profile').value === 'editing'){
                                        document.getElementById('btnedit_profile').value = 'done'   
                                        // var preusername = document.getElementById('fname')
                                        // var prepassword = document.getElementById('pword')
                                        // var preconfirmpassword = document.getElementById('cpword')
                                        var edit_butt = document.getElementById('btnedit_profile')
                                        edit_butt.innerHTML = 'Update'
                                        // edit_butt.setAttribute('type', 'submit')

                                        //---------------เมื่อกดปุ่มให้เปลี่ยนเปน input text เพื่อรับข้อมูลใหม่
                                        passname.innerHTML = `<input type="text" id="edituserid" name="username" value="<%= user.user_name %>"/>`
                                        pass_password.innerHTML = `<input type="password" id="edituserpassword" name="password" value=""/>`
                                        pass_confirmpassword.innerHTML = `<input type="password" id="editconfirmpassword" name="repassword" value=""/>`   
                                    }
                                    document.getElementById('btncancle_profile').onclick = function(){//กดปุ่ม Cancle
                                                // popup.classList.remove('show')
                                                // popcon_password.value=''
                                                // error_messsage.innerHTML = ''
                                                window.location.href = window.location.href;
                                                
                                    }

                                    document.getElementById('btnedit_profile').onclick = function(){
                                            // console.log(newusername.value,newpassword.value,newconpassword.value)
                                            // var result = checknewusername(newusername.value) //--------เช็คว่า username ถูกต้องหรือไม่
                                            // var result2 = checknewpassword(newpassword.value) //-------เช็คว่า password ถูกต้องหรือไม่
                                            // var result3 = checkconpassword(newpassword.value,newconpassword.value) //เช็คว่า password ตรงกันหรือไม่
                                            // if(result === true && result2 === true && result3 == true){  //ข้อมูลถูกต้องหมด
                                            //------------------จัดการ popup------------------
                                            popup = document.getElementById('modal_contain')
                                            popup.classList.add('show') //แสดง popup จากไฟล์ css style4
                                            // const popcon_password = document.getElementById('popcon_password')
                                            // const error_messsage = document.getElementById('error_messsage')
                                            // document.getElementById('popcon').onclick = function(){ //กดปุ่ม Confirm
                                            //     if(popcon_password.value === '1234'){ //เช็ครหัสผ่าน
                                            //         window.location.href = 'index_profile.html'
                                            //     }
                                            //     else{
                                            //         console.log('fail')
                                            //         error_messsage.innerHTML = 'รหัสผ่านไม่ถูกต้อง'
                                            //     }
                                            // }
                                            document.getElementById('btncancle_profile2').onclick = function(){//กดปุ่ม Cancle
                                                popup.classList.remove('show')
                                                // popcon_password.value=''
                                                error_messsage.innerHTML = ''
                                                window.location.href = window.location.href;
                                                
                                            }
                                        }
                                })
                            </script>
                      </div>
                      <div class="bio-row">
                        <form id="usermoney">
                        <p style="color: white; font-size: 15px;display: inline;"><i style="color: blueviolet;" class="fa-brands fa-bitcoin"></i> My money : <p style="color: white; font-size: 15px; display: inline;" id="my_money"><%= user.user_money %></p></p>
                        <p style="color: white; font-size: 15px;display: inline;"><i style="color: blueviolet;"class="fa-solid fa-star"></i></i> My score : <p style="color: white; font-size: 15px; display: inline;" id="my_score"><%= user.user_point %></p></p>
                        <a href="/payment/<%= user._id %>"><button style="margin-top: 1rem; height: 33px;width: 100px; font-size: 15px; padding: 0;" type="button" id="buttpayment" class="btn btn-success">Payment</button></a>
                        </form>
                      </div>
                  </div>
                </div>
              </div>
              <br>
              <br>
          
        </div>
        </div>
        </div>

        <span style="margin-left:7.5vw ; font-size: 21px;">Read On</span>
        <div style="height: 20rem;width:81.5rem ;margin-left: 7.5vw;margin-top: 20px; background-color: rgb(227, 227, 227); padding: 10px; border-radius: 5px;">
            <div id="wrapper">
                <% for(var i = 0;i < read_on.length;i++){ %>
                <div class="itembook">
                    <div class="picture">
                        <img src="data:read_on[i]/<%= read_on[i].book_img.contentType %>;base64,
                        <%= read_on[i].book_img.data.toString('base64') %>" style="width: 150px; height: 200px;">
                    </div>
                    <button class="btn" id="butt0" style="width: 100px; background-color: green; color: white;">อ่านต่อ</button>
                </div>
                <% } %>
            </div>
        </div>
        <br>
        <br>
        <span style="margin-left:7.5vw ; font-size: 21px;">My Library</span>
        <div style="height: 32rem;width:81.5rem ;margin-left: 7.5vw;margin-top: 20px; background-color: rgb(227, 227, 227); padding: 10px; border-radius: 5px;">
            <div class="mylibpicture">
                <% for(var i = 0;i < book_rent.length;i++){ %>
                <a href="/book/<%= book_rent[i].book_id %>"><img src="data:book_rent[i]/<%= book_rent[i].book_img.contentType %>;base64,
                                    <%= book_rent[i].book_img.data.toString('base64') %>" 
                                    style="width: 150px; height: 200px; margin-left: 3.5rem; margin-bottom: 3.5rem; margin-top: 1.5rem; "></a>
                <% } %>
                <% for(var i = 0;i < book_notrent.length;i++){ %>
                    <a href="/book/<%= book_notrent[i].book_id %>"><img src="data:book_notrent[i]/<%= book_notrent[i].book_img.contentType %>;base64,
                                        <%= book_notrent[i].book_img.data.toString('base64') %>" 
                                        style="width: 150px; height: 200px; margin-left: 3.5rem; margin-bottom: 3.5rem; margin-top: 1.5rem; filter: grayscale(100%);"></a>
                <% } %>
            </div>
        </div>
        <br>
        <br>
        <span style="margin-left:7.5vw ; font-size: 21px;">My Thread</span>
        <div style="height: 32rem;width:81.5rem ;margin-left: 7.5vw;margin-top: 20px; background-color: rgb(227, 227, 227); padding: 10px; border-radius: 5px;">
            <div id="wrapper2">
                <% for(var i = 0;i < userthread.length;i++){ %>
                    <div class="itemthread">
                        <div>
                            <img id="t_imger" src="data:userthread[i]/<%= userthread[i].book_img.contentType %>;base64,
                            <%= userthread[i].book_img.data.toString('base64') %>" 
                            style="width: 150px; height: 200px; margin-left: 30px; vertical-align: top;">
                            <div id="t_boxtext" style="margin-left: 25px;">
                                <div class="display_text"><%= userthread[i].content %></div>
                                <a href="/thread/<%= userthread[i]._id %>">
                                <button id="t_butt" class="btn">ไปที่กระทู้</button>
                                </a>
                            </div>
                        </div>
                    </div>
                <% } %>
            </div>
        </div>



    <script src="/javascripts/bootstrap/bootstrap.min.js"></script>
    <!-- <script src="custom_js/custom2.js"></script> -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery-validation@1.19.3/dist/jquery.validate.js"></script>
</body>
</html>